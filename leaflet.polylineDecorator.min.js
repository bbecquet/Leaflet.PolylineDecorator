L.LineUtil.PolylineDecorator={computeAngle:function(a,b){return Math.atan2(b.y-a.y,b.x-a.x)*180/Math.PI+90},getPointPathPixelLength:function(a){var b=a.length;if(b<2)return 0;for(var c=0,d=a[0],e=1;e<b;e++)c+=d.distanceTo(d=a[e]);return c},getPixelLength:function(a,b){var c=a instanceof L.Polyline?a.getLatLngs():a,d=c.length;if(d<2)return 0;for(var e=0,f=b.latLngToLayerPoint(c[0]),g=1;g<d;g++)e+=f.distanceTo(f=b.latLngToLayerPoint(c[g]));return e},projectPatternOnPath:function(a,b,c,d){var e=[],f;
for(f=0,l=a.length;f<l;f++)e[f]=d.latLngToLayerPoint(a[f]);a=this.projectPatternOnPointPath(e,b,c);for(f=0,l=a.length;f<l;f++)a[f].latLng=d.layerPointToLatLng(a[f].pt);return a},projectPatternOnPointPath:function(a,b,c){var d=[],e=this.getPointPathPixelLength(a)*c,b=this.interpolateOnPointPath(a,b);d.push(b);if(c>0){a=a.slice(b.predecessor);a[0]=b.pt;for(c=this.getPointPathPixelLength(a);e<=c;)b=this.interpolateOnPointPath(a,e/c),d.push(b),a=a.slice(b.predecessor),a[0]=b.pt,c=this.getPointPathPixelLength(a)}return d},
interpolateOnPointPath:function(a,b){var c=a.length;if(c<2)return null;if(b<=0)return{pt:a[0],predecessor:0,heading:this.computeAngle(a[0],a[1])};if(b>=1)return{pt:a[c-1],predecessor:c-1,heading:this.computeAngle(a[c-2],a[c-1])};if(c==2)return{pt:this.interpolateBetweenPoints(a[0],a[1],b),predecessor:0,heading:this.computeAngle(a[0],a[1])};for(var d=this.getPointPathPixelLength(a),e=a[0],f=e,g=0,h=0,j=0,i=1;i<c&&h<b;i++)e=f,g=h,f=a[i],j+=e.distanceTo(f),h=j/d;return{pt:this.interpolateBetweenPoints(e,
f,(b-g)/(h-g)),predecessor:i-2,heading:this.computeAngle(e,f)}},interpolateBetweenPoints:function(a,b,c){return b.x!=a.x?new L.Point(a.x*(1-c)+c*b.x,a.y*(1-c)+c*b.y):new L.Point(a.x,a.y+(b.y-a.y)*c)}};
L.RotatedMarker=L.Marker.extend({options:{angle:0},statics:{bestTransform:L.DomUtil.testProp(["transform","WebkitTransform","msTransform","MozTransform","OTransform"])},_setPos:function(a){L.Marker.prototype._setPos.call(this,a);a=" rotate("+this.options.angle+"deg)";if(L.RotatedMarker.bestTransform)this._icon.style[L.RotatedMarker.bestTransform]+=a;else if(L.Browser.ie){var b=this.options.angle*L.LatLng.DEG_TO_RAD,a=Math.cos(b),b=Math.sin(b);this._icon.style.filter+=" progid:DXImageTransform.Microsoft.Matrix(sizingMethod='auto expand', M11="+
a+", M12="+-b+", M21="+b+", M22="+a+")"}}});L.Symbol=L.Symbol||{};
L.Symbol.Dash=L.Class.extend({isZoomDependant:true,options:{pixelSize:10,pathOptions:{}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=false},buildSymbol:function(a,b,c){b=this.options;if(b.pixelSize<=1)return new L.Polyline([a.latLng,a.latLng],b.pathOptions);var d=c.project(a.latLng),a=-(a.heading-90)*L.LatLng.DEG_TO_RAD,a=new L.Point(d.x+b.pixelSize*Math.cos(a+Math.PI)/2,d.y+b.pixelSize*Math.sin(a)/2),d=d.add(d.subtract(a));return new L.Polyline([c.unproject(a),
c.unproject(d)],b.pathOptions)}});
L.Symbol.ArrowHead=L.Class.extend({isZoomDependant:true,options:{polygon:true,pixelSize:10,headAngle:60,pathOptions:{stroke:false,weight:2}},initialize:function(a){L.Util.setOptions(this,a);this.options.pathOptions.clickable=false},buildSymbol:function(a,b,c){b=this.options;return b.polygon?new L.Polygon(this._buildArrowPath(a,c),b.pathOptions):new L.Polyline(this._buildArrowPath(a,c),b.pathOptions)},_buildArrowPath:function(a,b){var c=b.project(a.latLng),d=-(a.heading-90)*L.LatLng.DEG_TO_RAD,e=this.options.headAngle/
2*L.LatLng.DEG_TO_RAD,f=d+e;d-=e;f=new L.Point(c.x-this.options.pixelSize*Math.cos(f),c.y+this.options.pixelSize*Math.sin(f));c=new L.Point(c.x-this.options.pixelSize*Math.cos(d),c.y+this.options.pixelSize*Math.sin(d));return[b.unproject(f),a.latLng,b.unproject(c)]}});
L.Symbol.Marker=L.Class.extend({isZoomDependant:false,options:{markerOptions:{},rotate:false},initialize:function(a){L.Util.setOptions(this,a);this.options.markerOptions.clickable=false;this.options.markerOptions.draggable=false;this.isZoomDependant=L.Browser.ie&&this.options.rotate},buildSymbol:function(a){return this.options.rotate?(this.options.markerOptions.angle=a.heading,new L.RotatedMarker(a.latLng,this.options.markerOptions)):new L.Marker(a.latLng,this.options.markerOptions)}});
L.PolylineDecorator=L.LayerGroup.extend({options:{patterns:[]},initialize:function(a,b){L.LayerGroup.prototype.initialize.call(this);L.Util.setOptions(this,b);this._polyline=a;this._initPatterns()},_initPatterns:function(){this._isZoomDependant=false;this._patterns=[];for(var a,b=0;b<this.options.patterns.length;b++)a=this._parsePatternDef(this.options.patterns[b]),this._patterns.push(a),this._isZoomDependant=this._isZoomDependant||a.isOffsetInPixels||a.isRepeatInPixels||a.symbolFactory.isZoomDependant},
setPatterns:function(a){this.options.patterns=a;this._initPatterns();this._softRedraw()},_parsePatternDef:function(a){var b={cache:[],symbolFactory:a.symbol,isOffsetInPixels:false,isRepeatInPixels:false};typeof a.offset==="string"&&a.offset.indexOf("%")!=-1?b.offset=parseFloat(a.offset)/100:(b.offset=parseFloat(a.offset),b.isOffsetInPixels=b.offset>0);typeof a.repeat==="string"&&a.repeat.indexOf("%")!=-1?b.repeat=parseFloat(a.repeat)/100:(b.repeat=parseFloat(a.repeat),b.isRepeatInPixels=b.repeat>
0);return b},onAdd:function(a){this._map=a;this._draw();if(this._isZoomDependant)this._map.on("zoomend",this._softRedraw,this)},onRemove:function(a){this._map.off("zoomend",this._softRedraw,this);L.LayerGroup.prototype.onRemove.call(this,a)},_buildSymbols:function(a,b){for(var c=[],d=0,e=b.length;d<e;d++)c.push(a.buildSymbol(b[d],this._latLngs,this._map,d,e));return c},_getDirectionPoints:function(a){var b=a.cache[this._map.getZoom()];if(typeof b!="undefined")return b;this._latLngs=this._polyline instanceof
L.Polyline?this._polyline.getLatLngs():this._polyline;if(this._latLngs.length<2)return[];this._polyline instanceof L.Polygon&&this._latLngs.push(this._latLngs[0]);var c;c=null;a.isOffsetInPixels?(c=L.LineUtil.PolylineDecorator.getPixelLength(this._latLngs,this._map),b=a.offset/c):b=a.offset;a.isRepeatInPixels?(c=c!==null?c:L.LineUtil.PolylineDecorator.getPixelLength(this._latLngs,this._map),c=a.repeat/c):c=a.repeat;b=L.LineUtil.PolylineDecorator.projectPatternOnPath(this._latLngs,b,c,this._map);return a.cache[this._map.getZoom()]=
b},redraw:function(){this._redraw(true)},_softRedraw:function(){this._redraw(false)},_redraw:function(a){this.clearLayers();if(a)for(a=0;a<this._patterns.length;a++)this._patterns[a].cache=[];this._draw()},_drawPattern:function(a){for(var b=this._getDirectionPoints(a),a=this._buildSymbols(a.symbolFactory,b),b=0;b<a.length;b++)this.addLayer(a[b])},_draw:function(){for(var a=0;a<this._patterns.length;a++)this._drawPattern(this._patterns[a])}});
L.polylineDecorator=function(a,b){return new L.PolylineDecorator(a,b)};
